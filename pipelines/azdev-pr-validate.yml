pr:
  paths:
    exclude:
    - README.md

variables:
- group: CI-Tokens

steps:
- pwsh: |
    Install-Module -Name Pester -SkipPublisherCheck -Scope CurrentUser -RequiredVersion "5.3.0" -Force
    Install-Module -Name AzurePipelinesPS -Scope CurrentUser -RequiredVersion "4.0.7" -Force
    Install-Module -Name PowerShellForGitHub -Scope CurrentUser -RequiredVersion "0.16.0" -Force
    $AzDevToken = ConvertTo-SecureString -AsPlainText "$(CI-PAT)" -Force
    ./_TestAll.ps1 -AzDevToken $AzDevToken
  displayName: Run Pester
  workingDirectory: '$(Build.SourcesDirectory)'
